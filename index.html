<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Solicitação de Tarefas</title>
  <link href="https://fonts.googleapis.com/css2?family=Jura:wght@400&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Jura', sans-serif;
      background-color: white;
      color: #333;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #000;
      padding: 1rem 2rem;
      color: #fff;
    }

    .logo {
      width: 100px;
      height: 50px;
      background-color: #00FFFF;
      border-radius: 5px;
      text-align: center;
      line-height: 50px;
      font-weight: bold;
    }

    main {
      max-width: 600px;
      margin: 2rem auto;
      background-color: #fff;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    h1 {
      color: #1B1464;
      text-align: center;
    }

    label {
      display: inline-block;
      margin-top: 1rem;
      font-weight: bold;
    }

    input,
    select,
    textarea {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-family: 'Jura', sans-serif;
    }

    .radio-group {
      display: flex;
      gap: 2rem;
      margin-top: 0.3rem;
      align-items: center;
      justify-content: flex-start;
      height: auto;
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: normal;
      width: auto;
      height: auto;
    }

    .radio-option input[type="radio"] {
      margin: 3px auto 0;
      display: block;
      height: auto;
    }

    .radio-option span {
      white-space: nowrap;
      height: auto;
    }

    button {
      margin-top: 1.5rem;
      padding: 0.75rem 2rem;
      background: linear-gradient(90deg, #00DBDE 0%, #4A00E0 50%, #8E2DE2 100%);
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
    }

    button:hover {
      opacity: 0.9;
    }

    #mensagem {
      display: none;
      margin-top: 1rem;
      padding: 0.75rem;
      border-radius: 5px;
      font-weight: bold;
      text-align: center;
    }

    .sucesso {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .erro {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
  </style>
</head>
<body>
  <header>
    <h2>Solicitação de Tarefas</h2>
    <div class="logo">LOGO</div>
  </header>

  <main>
    <h1>Formulário de Tarefa</h1>
    <div id="taskForm">
      <label>Tipo da Solicitação</label>
      <div class="radio-group">
        <label class="radio-option">
          <input type="radio" name="tipo" value="consultar" checked>
          <span>Consultar Task</span>
        </label>
        <label class="radio-option">
          <input type="radio" name="tipo" value="criar">
          <span>Criar Task</span>
        </label>
      </div>

      <label for="idProjeto">ID do Projeto</label>
      <input type="text" id="idProjeto">

      <div id="tipoTaskGroup" style="display: none;">
        <label>Tipo de Item</label>
        <div class="radio-group">
          <label class="radio-option">
            <input type="radio" name="tipoItem" value="task" checked>
            <span>Task</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="tipoItem" value="subtask">
            <span>Subtask</span>
          </label>
        </div>
      </div>

      <label for="idTask">ID da Task</label>
      <input type="text" id="idTask">

      <label for="nomeTask">Nome da Task</label>
      <input type="text" id="nomeTask">

      <label for="descricao">Descrição da Task</label>
      <textarea id="descricao" rows="4"></textarea>

      <label for="dataInicio">Data de Início</label>
      <input type="date" id="dataInicio">

      <label for="dataFim">Data de Fim</label>
      <input type="date" id="dataFim">

      <label for="horasEstimadas">Horas Estimadas</label>
      <input type="number" id="horasEstimadas" min="0" step="0.1">

      <div id="mensagem"></div>
      <button type="button" onclick="enviarTask()">Enviar</button>
    </div>
  </main>

  <script>
    const camposCondicionais = [
      'idProjeto',
      'nomeTask',
      'descricao',
      'dataInicio',
      'dataFim',
      'horasEstimadas'
    ].map(id => document.getElementById(id));

    const tipoRadios = document.querySelectorAll('input[name="tipo"]');

    function toggleFields() {
      const isConsultar = document.querySelector('input[name="tipo"]:checked').value === 'consultar';
      camposCondicionais.forEach(el => el.disabled = isConsultar);
      document.getElementById('tipoTaskGroup').style.display = isConsultar ? 'none' : 'block';
    }

    tipoRadios.forEach(radio => radio.addEventListener('change', toggleFields));
    window.addEventListener('DOMContentLoaded', toggleFields);

    function exibirMensagem(texto, sucesso = true) {
      const msg = document.getElementById('mensagem');
      msg.className = sucesso ? 'sucesso' : 'erro';
      msg.textContent = texto;
      msg.style.display = 'block';
      setTimeout(() => {
        msg.style.display = 'none';
        msg.textContent = '';
      }, 5000);
    }

    async function enviarTask() {
      const tipo = document.querySelector('input[name="tipo"]:checked').value;
      const tipoItem = document.querySelector('input[name="tipoItem"]:checked')?.value || null;

      const payload = {
        event_name: tipo,
        task_id: document.getElementById('idTask').value
      };

      try {
        const response = await fetch('https://prod-30.brazilsouth.logic.azure.com:443/workflows/e57b8efd7a6b472aae5371054b261c7b/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=Zw2AXHRvfhgFshDYj_9el5SdXs8oSi8NeiPqvY4hte8', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        });

        if (!response.ok) throw new Error('Erro ao consultar API');

        const data = await response.json();

        document.getElementById('nomeTask').value = data.title || '';
        document.getElementById('descricao').value = data.description ? data.description.replace(/<[^>]*>/g, '') : '';
        document.getElementById('idProjeto').value = data.project_id || '';
        document.getElementById('dataInicio').value = data.datetime ? data.datetime.split(' ')[0] : '';
        document.getElementById('dataFim').value = data.deadline ? data.deadline.split(' ')[0] : '';
        document.getElementById('horasEstimadas').value = data.estimated_hours || '';

        exibirMensagem('Dados carregados com sucesso!', true);
      } catch (error) {
        console.error('Erro ao enviar ou processar:', error);
        exibirMensagem('Erro ao consultar a API. Verifique o console.', false);
      }
    }
  </script>
</body>
</html>
